% =============================================================================
% Quantisation (core 3)
% Careful: need to check if values are negative before shifting them
% =============================================================================

ori         r0,  r0,  242 > (13,3)  ; connect to the memory holding the table
or          r20, ch1, r0            ; store the location of the quantisation table
and         r2,  r0,  r0            ; zero the current index in the table
addu        r3,  r20, r2            ; find the location of the value we want next
ld          r3,  0        > (13,2)  ; load the value
srl         r0,  ch0, ch1 > (4,2)   ; do quantisation and send result to zigzag
addi        r2,  r2,  1             ; increment index
andi        r2,  r2,  63            ; don't let the index pass 63
ibjmp.eop   -5                      ; loop