# Set up connection with memory.
ori                r3, r0, (1,8,0,3,6)       # First memory bank, first channel, eight bank group
ori                r4, r0, (1,1,2)           # Core 1, first channel
setchmap           1,  r3                    # Set data fetch channel to memory bank
setchmap           2,  r4
ori                r0, r0, 0x00360103 > 1    # Configuration command: General purpose cache, eight banks
ori                r0, r0, 0x01000000 > 1    # Table update command data fetch channel
ori                r0, r0, (1,0,2) > 1       # First data channel of first core
or                 r5, r0,  r0               # r5 = position in array
ori                r0, ch0, r0               # Wait for memory configuration to complete

# Load parameters
ldw                r0,  4           -> 1
ldw                r0,  8           -> 1
ori                r2,  ch0, 0               # r2 = rows of input
ori                r3,  ch0, 0               # r3 = columns of input
mullw              r4,  r3,  r2              # r4 = length of input

# Loop
ldbu               r5, 0x12000 > 1
addui              r5, r5, 1
seteq.p            r0, r5, r4                # See if we have reached the end of data
or                 r0, ch0, r0 > 2           # Receive value and send it on
if!p?ibjmp         -32
or.eop             r0, r0, r0